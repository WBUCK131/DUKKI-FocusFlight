<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DUKKI FocusFlight 3D (OL/Cesium)</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.4.0/ol.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cesium@1.111.0/Build/Cesium/Widgets/widgets.css">
    
    <link rel="stylesheet" href="style.css" />
    <style>
        /* OpenLayers/Cesium 연동 시 지도 컨테이너 스타일 */
        #map {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /* OpenLayers 마커(Overlay)가 UI와 겹치지 않게 z-index 조정 */
        .ol-overlay-container { z-index: 10; }
        /* Cesium 저작권 표시 위치 조정 (UI와 겹치지 않게) */
        .cesium-viewer-bottom {
            bottom: 80px !important; 
            opacity: 0.7;
        }
        /* OpenLayers 기본 줌 컨트롤 숨김 (단순화를 위해) */
        .ol-zoom, .ol-rotate { display: none; }
    </style>
</head>

<body class="map-style-satellite"> 

<audio id="backgroundMusic" src="soundair.mp3" preload="auto" loop></audio>

<div id="map"></div>

<div id="flightPopup" class="flight-popup" style="display:none;"></div>

<div id="stampAnimation">
    <div style="
        font-size: 0.8em; 
        font-weight: 900; 
        line-height: 1;
        margin-bottom: 2px;
    ">FLIGHT SUCCESS</div>
    <div id="stampCode"></div>
</div>

<div id="startContainer" class="glass-morphism">
    <h2 id="startTitle">DUKKI FocusFlight 3D</h2>
    <div id="welcomeMessage"></div>
    <div id="currentTime" class="time-display"></div>
    
    <div id="userStats" class="stats-container">
        <div class="stat-item"><span class="stat-label">이름</span><span id="userNameStat"></span></div>
        <div class="stat-item"><span class="stat-label">잔액</span><span id="moneyStat">0원</span></div>
        <div class="stat-item"><span class="stat-label">비행 수</span><span id="flightCountStat">0</span></div>
    </div>

    <div id="searchContainer">
        <input type="text" id="arrivalSearch" placeholder="도착 공항 검색..." />
        <div id="arrivalList" class="arrival-list"></div>
    </div>
    
    <div id="flightInfo" class="flight-info-container" style="display:none;">
        <div class="flight-detail">
            <span>출발지</span><span id="departureCode"></span>
        </div>
        <div class="flight-detail">
            <span>도착지</span><span id="arrivalCode"></span>
        </div>
        <div class="flight-detail">
            <span>비행 시간</span><span id="flightDuration"></span>
        </div>
        <div class="flight-detail">
            <span>보상 금액</span><span id="rewardAmount"></span>
        </div>
        
        <div id="slideTrack" class="slide-track">
            <div id="slideBackground"></div>
            <div id="slideText">슬라이드하여 비행 시작</div>
            <div id="slideHandle">✈️</div>
        </div>
    </div>
</div>

<div id="recordsContainer" class="modal" style="display:none;">
    <div class="settings-content">
        <button class="close-container-btn" id="closeRecordsBtn">×</button>
        <h3>✈️ 비행 기록</h3>
        <div class="record-filter-buttons">
            <button class="record-filter-btn active" data-filter="all">전체</button>
            <button class="record-filter-btn" data-filter="success">성공</button>
            <button class="record-filter-btn" data-filter="fail">실패</button>
        </div>
        <ul id="recordList" class="record-list"></ul>
    </div>
</div>

<div id="trendsContainer" class="modal" style="display:none;">
    <div class="settings-content">
        <button class="close-container-btn" id="closeTrendsBtn">×</button>
        <h3>📈 시장 동향</h3>
        <div id="trendsContent" style="text-align: center; color: var(--color-text-dim); margin-top: 50px;">
            <p>시장의 변동성이 감지됩니다.</p>
            <p id="trendInfo"></p>
        </div>
    </div>
</div>

<div id="settingsModal" class="modal" style="display:none;">
    <div class="settings-content">
        <button class="close-container-btn" id="closeSettingsBtn">×</button>
        <h3>⚙️ 설정</h3>
        <h4 style="color:var(--color-primary); margin-bottom: 5px;">사용자 이름</h4>
        <div class="username-section">
            <input type="text" id="usernameInput" placeholder="이름을 입력하세요" />
            <button id="saveUsernameBtn">저장</button>
        </div>
        <h4 style="color:var(--color-primary); margin-top: 20px; margin-bottom: 5px;">지도 스타일 (3D 활성화/비활성화)</h4>
        <div class="style-buttons">
            <button class="map-style-button" data-style="2d">2D (일반)</button>
            <button class="map-style-button" data-style="2d-dark">2D (다크)</button>
            <button class="map-style-button active" data-style="satellite">3D (지구본)</button>
        </div>
        <h4 style="color:var(--color-primary); margin-top: 20px; margin-bottom: 5px;">데이터 관리 💾</h4>
        <button onclick="exportData()">데이터 내보내기</button>
        <button onclick="importData()">데이터 불러오기</button>
        <div style="font-size: 12px; color: #888; text-align: center; margin-top: 10px;">By TEAMBUCK</div> 
        <button id="closeSettingsModalBtn">닫기</button>
    </div>
</div>

<div class="modal" id="shopContainer">
    <div class="settings-content"> <button class="close-container-btn" id="closeShopBtn">×</button> 
        <h3>🛍️ 아이템 상점</h3>
        <p style="text-align: center; color: var(--color-text-dim); margin-top: 50px; margin-bottom: 50px;">
            아직 준비 중입니다.<br>
            곧 다양한 아이템이 추가될 예정입니다! ✈️
        </p>
        <div style="font-size: 12px; color: #888; text-align: center; margin-top: 10px;">By TEAMBUCK</div> 
    </div>
</div>

<div class="bottom-nav glass-morphism">
    <button id="homeBtn" class="nav-btn active"><span class="icon">🏠</span>홈</button>
    <button id="recordsBtn" class="nav-btn"><span class="icon">📋</span>기록</button>
    <button id="trendsBtn" class="nav-btn"><span class="icon">📈</span>동향</button>
    <button id="shopBtn" class="nav-btn"><span class="icon">🛍️</span>상점</button>
    <button id="settingsBtn" class="nav-btn"><span class="icon">⚙️</span>설정</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/cesium@1.111.0/Build/Cesium/Cesium.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ol@v7.4.0/dist/ol.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ol-cesium@2.15.0/dist/olcs.js"></script>

<script src="main.js"></script>
</body>
</html>